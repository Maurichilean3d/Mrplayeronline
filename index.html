<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>MR Studio Diamond v7.2 | Billboard Priority</title>
  <script src="https://unpkg.com/omggif@1.0.10/omggif.js"></script>
  <style>
    * { box-sizing: border-box; user-select: none; }
    body { margin: 0; overflow: hidden; background: transparent; font-family: 'Segoe UI', system-ui, sans-serif; color: #eee; }
    #c { position: fixed; inset: 0; width: 100%; height: 100%; touch-action: none; z-index: 0; }
    
    /* UI MEJORADA */
    .ui-panel { 
      position: fixed; left: 20px; top: 20px; width: 400px; max-height: 90vh; 
      background: rgba(12, 12, 16, 0.95); backdrop-filter: blur(20px); 
      border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 16px; 
      padding: 15px; overflow-y: auto; z-index: 100; 
      box-shadow: 0 20px 50px rgba(0,0,0,0.9);
      transition: transform 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);
    }
    .ui-panel.minimized { transform: translateX(-450px); }
    
    #toggleUI {
        position: fixed; left: 20px; top: 20px; z-index: 101;
        width: 40px; height: 40px; border-radius: 50%; background: #6c5ce7;
        border: none; color: white; cursor: pointer; display: none;
        box-shadow: 0 4px 12px rgba(0,0,0,0.5); font-weight: bold;
    }

    h2 { margin: 0 0 15px 0; font-size: 18px; color: #a29bfe; font-weight: 800; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 8px;}
    .sec-head { font-size: 10px; font-weight: 800; color: #74b9ff; margin: 15px 0 8px 0; text-transform: uppercase; letter-spacing: 1px; }
    
    .row { display: flex; align-items: center; gap: 10px; margin-bottom: 8px; }
    label { font-size: 11px; flex: 1; color: #ccc; }
    input[type=range] { flex: 2; height: 4px; accent-color: #6c5ce7; cursor: pointer; background: #333; border-radius: 2px; }
    input[type=checkbox] { width: 16px; height: 16px; accent-color: #6c5ce7; cursor: pointer; }
    .val { width: 40px; text-align: right; font-size: 10px; color: #a29bfe; font-family: monospace; }
    
    select, input[type=url] { width: 100%; background: #1e1e24; border: 1px solid #333; color: #eee; padding: 8px; border-radius: 6px; font-size: 11px; outline: none; }
    
    button { flex: 1; padding: 10px; border-radius: 6px; border: none; font-size: 11px; font-weight: 700; cursor: pointer; color: white; background: #2d3436; transition: 0.2s; }
    button:active { transform: scale(0.96); }
    button.primary { background: #6c5ce7; }
    button.danger { background: rgba(214, 48, 49, 0.2); color: #ff7675; border: 1px solid #d63031; }
    button.media-btn { background: #0984e3; }

    .layer-list { max-height: 120px; overflow-y: auto; background: rgba(0,0,0,0.3); border-radius: 8px; padding: 5px; margin-bottom: 10px; border: 1px solid #333; }
    .layer-item { padding: 8px; font-size: 11px; border-radius: 5px; cursor: pointer; display: flex; align-items: center; gap: 8px; margin-bottom: 2px; }
    .layer-item:hover { background: rgba(255,255,255,0.05); }
    .layer-item.active { background: rgba(108, 92, 231, 0.25); border-left: 3px solid #6c5ce7; }

    #vrBtn { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); padding: 14px 40px; background: #6c5ce7; color: white; border-radius: 50px; font-weight: 800; z-index: 1000; display: none; box-shadow: 0 0 30px rgba(108,92,231,0.6); border: 2px solid white; }
    .loader { position: fixed; inset: 0; background: #000; z-index: 5000; display: none; place-items: center; color: #a29bfe; font-weight: 900; letter-spacing: 2px; }
  </style>
</head>
<body>

<canvas id="c"></canvas>
<div class="loader" id="loader">CARGANDO DIAMOND v7.2...</div>
<button id="toggleUI" onclick="toggleUIPanel()">‚ò∞</button>

<div class="ui-panel" id="ui">
  <h2>
      <span>üíé DIAMOND v7.2</span>
      <button style="width:auto; padding:4px 8px; background:transparent; font-size:16px;" onclick="toggleUIPanel()">√ó</button>
  </h2>

  <div class="sec-head">üì• Importar Contenido</div>
  <div class="row">
    <input type="url" id="webUrl" placeholder="Pegar URL (.mp4, .gif, .png)">
    <button class="primary" onclick="loadFromWeb()" style="width:60px;">ADD</button>
  </div>
  <button onclick="document.getElementById('fileInput').click()" style="width:100%; margin-top:5px;">üìÅ ABRIR LOCAL</button>
  <input type="file" id="fileInput" multiple style="display:none;">

  <div class="sec-head">Capas Activas</div>
  <div id="layerList" class="layer-list"></div>

  <div id="editorUI" style="display:none;">
    
    <div style="background: rgba(108, 92, 231, 0.1); padding: 10px; border-radius: 8px; border: 1px solid rgba(108, 92, 231, 0.3); margin-bottom: 10px;">
        <div class="row" style="margin:0;">
            <input type="checkbox" id="checkBillboard" style="width:20px; height:20px;"> 
            <label style="font-weight:bold; color: #fff; font-size:12px;">ACTIVAR BILLBOARD (Mirar a c√°mara)</label>
        </div>
    </div>

    <div class="sec-head">‚ú® Estilo & Holograma</div>
    <div class="row"><label>Opacidad</label><input type="range" id="opacity" min="0" max="1" step="0.01" value="1"><span class="val" id="v_opacity">1.0</span></div>
    <div class="row"><label>Emisi√≥n (Luz)</label><input type="range" id="emissive" min="0" max="2" step="0.01" value="0"><span class="val" id="v_emissive">0.0</span></div>
    
    <div class="sec-head">üéÆ Media Controls</div>
    <div class="row" style="gap:5px;">
        <button id="btnPlay" class="media-btn" onclick="mediaAction('play')">‚ñ∂ Play</button>
        <button id="btnPause" class="media-btn" onclick="mediaAction('pause')">‚è∏ Pause</button>
        <button id="btnMute" class="media-btn" onclick="mediaAction('mute')">üîá Mute</button>
    </div>

    <div class="sec-head">üìê Transformaci√≥n</div>
    <div class="row"><label>Escala</label><input type="range" id="scale" min="0.01" max="10" step="0.01" value="1"><span class="val" id="v_scale">1.0</span></div>
    <div class="row"><label>Altura Y</label><input type="range" id="posY" min="-5" max="5" step="0.1" value="1.6"><span class="val" id="v_posY">1.6</span></div>
    <div class="row"><label>Dist. Z</label><input type="range" id="posZ" min="-10" max="10" step="0.1" value="-2"><span class="val" id="v_posZ">-2.0</span></div>
    
    <div class="sec-head">üåê Proyecci√≥n</div>
    <select id="projSelect" onchange="updateProjection()">
      <option value="plane">Plano 2D (Standard)</option>
      <option value="curved">Pantalla Curva</option>
      <option value="orb">Orbe Flotante</option>
      <option value="360">Entorno 360¬∞</option>
    </select>

    <div class="sec-head">üß™ Chroma Key</div>
    <div class="row"><label><input type="checkbox" id="chromaToggle"> Activar Chroma</label></div>
    <div id="chromaPanel" style="display:none; padding:8px; background:rgba(255,255,255,0.05); border-radius:8px;">
        <div class="row">
            <input type="color" id="pickerColor" value="#00ff00" style="width:40px; height:30px; border:none; padding:0;">
            <label style="font-size:10px;">Color Key</label>
        </div>
        <div class="row"><label>Similitud</label><input type="range" id="k1sim" min="0" max="0.8" step="0.001" value="0.4"></div>
        <div class="row"><label>Suavizado</label><input type="range" id="k1smooth" min="0" max="0.4" step="0.001" value="0.08"></div>
    </div>
  </div>

  <div style="margin-top:20px; display:flex; gap:10px;">
    <button class="danger" onclick="deleteActive()">üóëÔ∏è ELIMINAR</button>
    <button onclick="centerActive()">üéØ RE-CENTRAR</button>
  </div>
  
  <div class="sec-head">‚öôÔ∏è Global</div>
  <div class="row"><label><input type="checkbox" id="checkOcclusion"> Oclusi√≥n Real (Depth API)</label></div>
</div>

<button id="vrBtn">ENTRAR EN MR</button>

<script type="importmap">
{ "imports": {
  "three": "https://cdn.jsdelivr.net/npm/three@0.170.0/build/three.module.js",
  "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.170.0/examples/jsm/"
} }
</script>

<script type="module">
import * as THREE from 'three';
import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
import { TransformControls } from 'three/addons/controls/TransformControls.js';

// --- SHADERS (Unlit + Alpha + Emissive) ---
const vShader = `
varying vec2 vUv; 
void main() { vUv = uv; gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0); }
`;

const fShader = `
uniform sampler2D map;
uniform bool chromaOn;
uniform vec3 k1; 
uniform float sim1; 
uniform float smooth1;
uniform float uOpacity;     
uniform float uEmissive;    
varying vec2 vUv;

void main() {
  vec4 tex = texture2D(map, vUv);
  
  float alpha = tex.a;
  if(chromaOn) {
    float d = distance(tex.rgb, k1);
    float k = smoothstep(sim1, sim1 + smooth1, d);
    alpha *= k;
  }
  
  alpha *= uOpacity;
  vec3 finalColor = tex.rgb * (1.0 + uEmissive);

  gl_FragColor = vec4(finalColor, alpha);
  if(alpha < 0.01) discard; 
}
`;

// --- DEPTH SHADER ---
const depthVS = `#version 300 es
precision highp float; in vec2 aPos; out vec2 vUv;
void main(){ vUv = aPos * 0.5 + 0.5; gl_Position = vec4(aPos, 0.0, 1.0); }`;
const depthFS = `#version 300 es
precision highp float; precision highp sampler2D;
in vec2 vUv; uniform sampler2D uDepth; uniform float uRawToMeters; uniform mat4 uProj; out vec4 outColor;
float decodeRaw(vec4 la){ return (la.r * 255.0 * 256.0 + la.a * 255.0); }
void main(){
  vec4 la = texture(uDepth, vUv);
  float zMeters = decodeRaw(la) * uRawToMeters;
  if(zMeters <= 0.0) discard;
  float z = -zMeters;
  float clipZ = uProj[2][2] * z + uProj[3][2];
  float clipW = uProj[2][3] * z + uProj[3][3];
  gl_FragDepth = clamp((clipZ / clipW) * 0.5 + 0.5, 0.0, 1.0);
  outColor = vec4(0.0);
}`;

let scene, camera, renderer, orbit, transformCtrl, xrSession, xrRefSpace;
let objects = [], activeId = null;
let xrGlBinding = null, depthProgram = null, depthVao = null, depthTex = null;
let occlusionEnabled = false;

function init() {
  scene = new THREE.Scene();
  scene.add(new THREE.AmbientLight(0xffffff, 1));

  camera = new THREE.PerspectiveCamera(70, window.innerWidth/window.innerHeight, 0.01, 500);
  camera.position.set(0, 1.6, 2);

  renderer = new THREE.WebGLRenderer({ canvas: document.getElementById('c'), antialias: true, alpha: true });
  renderer.setSize(window.innerWidth, window.innerHeight);
  renderer.setPixelRatio(window.devicePixelRatio);
  renderer.xr.enabled = true;

  orbit = new OrbitControls(camera, renderer.domElement);
  orbit.target.set(0, 1.6, -2);
  orbit.enableDamping = true;

  transformCtrl = new TransformControls(camera, renderer.domElement);
  transformCtrl.addEventListener('dragging-changed', e => orbit.enabled = !e.value);
  scene.add(transformCtrl);
  
  setupVR();
  renderer.setAnimationLoop(animate);
  
  document.getElementById('pickerColor').addEventListener('input', updateChromaFromPicker);
}

async function addAsset(url, type, name, isGif = false) {
  toggleLoader(true);
  let tex, mesh, gifData = null, video = null;

  try {
    if (isGif) {
      const resp = await fetch(url);
      const buf = await resp.arrayBuffer();
      const reader = new window.Omggif.GifReader(new Uint8Array(buf));
      const cvs = document.createElement('canvas');
      cvs.width = reader.width; cvs.height = reader.height;
      const ctx = cvs.getContext('2d');
      const imgData = ctx.createImageData(cvs.width, cvs.height);
      tex = new THREE.CanvasTexture(cvs);
      tex.colorSpace = THREE.SRGBColorSpace;
      gifData = { reader, ctx, imgData, tex, frame: 0, nextTime: 0, playing: true };
    } else if (type === 'video') {
      video = document.createElement('video');
      video.src = url;
      video.loop = true; video.muted = true; video.crossOrigin = "anonymous";
      video.playsInline = true;
      await video.play();
      tex = new THREE.VideoTexture(video);
      tex.colorSpace = THREE.SRGBColorSpace;
    } else {
      tex = await new THREE.TextureLoader().loadAsync(url);
      tex.colorSpace = THREE.SRGBColorSpace;
    }

    const mat = new THREE.ShaderMaterial({
      uniforms: { 
        map: { value: tex }, 
        chromaOn: { value: false }, 
        k1: { value: new THREE.Color(0,1,0) }, 
        sim1: { value: 0.4 }, 
        smooth1: { value: 0.08 },
        uOpacity: { value: 1.0 },
        uEmissive: { value: 0.0 }
      },
      vertexShader: vShader, 
      fragmentShader: fShader, 
      transparent: true, 
      side: THREE.DoubleSide,
      depthWrite: false
    });

    const aspect = video ? video.videoWidth/video.videoHeight : (tex.image ? tex.image.width/tex.image.height : 1.77);
    const geometry = new THREE.PlaneGeometry(aspect * 2, 2); 
    mesh = new THREE.Mesh(geometry, mat);
    mesh.position.set(0, 1.6, -2);
    
    const obj = { 
        id: Math.random().toString(36).substr(2,9), 
        name, mesh, video, gifData, type, 
        billboard: false,
        originalAspect: aspect
    };
    
    objects.push(obj);
    scene.add(mesh);
    selectObject(obj.id);
  } catch (e) { 
    console.error(e); 
    alert("Error cargando archivo. Intenta otra URL.");
  }
  toggleLoader(false);
}

function animate(time, frame) {
  orbit.update();
  
  objects.forEach(obj => {
      if(obj.billboard && obj.mesh) {
          obj.mesh.lookAt(camera.position.x, obj.mesh.position.y, camera.position.z);
      }
      
      if (obj.gifData && obj.gifData.playing) {
        const g = obj.gifData;
        if (performance.now() > g.nextTime) {
          g.reader.decodeAndBlitFrameRGBA(g.frame, g.imgData.data);
          g.ctx.putImageData(g.imgData, 0, 0);
          g.tex.needsUpdate = true;
          g.nextTime = performance.now() + (g.reader.frameInfo(g.frame).delay * 10 || 100);
          g.frame = (g.frame + 1) % g.reader.numFrames();
        }
      }
  });

  if (frame && occlusionEnabled && xrGlBinding) {
    const pose = frame.getViewerPose(xrRefSpace);
    if (pose) {
      const gl = renderer.getContext();
      gl.colorMask(false, false, false, false);
      for (const view of pose.views) {
        const depthInfo = xrGlBinding.getDepthInformation(view);
        if (depthInfo) {
           gl.bindTexture(gl.TEXTURE_2D, depthTex);
           gl.texImage2D(gl.TEXTURE_2D, 0, gl.LUMINANCE_ALPHA, depthInfo.width, depthInfo.height, 0, gl.LUMINANCE_ALPHA, gl.UNSIGNED_BYTE, depthInfo.data);
           gl.useProgram(depthProgram);
           gl.uniform1f(gl.getUniformLocation(depthProgram, 'uRawToMeters'), depthInfo.rawValueToMeters);
           gl.uniformMatrix4fv(gl.getUniformLocation(depthProgram, 'uProj'), false, view.projectionMatrix);
           gl.bindVertexArray(depthVao);
           gl.drawArrays(gl.TRIANGLES, 0, 6);
        }
      }
      gl.colorMask(true, true, true, true);
    }
  }

  renderer.render(scene, camera);
}

function selectObject(id) {
  activeId = id;
  const obj = objects.find(o => o.id === id);
  if (!obj) return;
  
  transformCtrl.attach(obj.mesh);
  document.getElementById('editorUI').style.display = 'block';
  
  document.getElementById('scale').value = obj.mesh.scale.x;
  document.getElementById('posY').value = obj.mesh.position.y;
  document.getElementById('posZ').value = obj.mesh.position.z;
  
  const mat = obj.mesh.material;
  document.getElementById('opacity').value = mat.uniforms.uOpacity.value;
  document.getElementById('emissive').value = mat.uniforms.uEmissive.value;
  document.getElementById('checkBillboard').checked = obj.billboard;
  
  const col = mat.uniforms.k1.value;
  const hex = '#' + col.getHexString();
  document.getElementById('pickerColor').value = hex;
  document.getElementById('chromaToggle').checked = mat.uniforms.chromaOn.value;
  document.getElementById('chromaPanel').style.display = mat.uniforms.chromaOn.value ? 'block' : 'none';

  updateLayers();
}

const bindSlider = (id, fn) => {
    document.getElementById(id).addEventListener('input', (e) => {
        const obj = objects.find(o => o.id === activeId);
        if(obj) {
            const v = parseFloat(e.target.value);
            fn(obj, v);
            const valSpan = document.getElementById('v_' + id);
            if(valSpan) valSpan.innerText = v.toFixed(2);
        }
    });
};

bindSlider('scale', (o,v) => o.mesh.scale.setScalar(v));
bindSlider('posY', (o,v) => o.mesh.position.y = v);
bindSlider('posZ', (o,v) => o.mesh.position.z = v);
bindSlider('opacity', (o,v) => o.mesh.material.uniforms.uOpacity.value = v);
bindSlider('emissive', (o,v) => o.mesh.material.uniforms.uEmissive.value = v);
bindSlider('k1sim', (o,v) => o.mesh.material.uniforms.sim1.value = v);
bindSlider('k1smooth', (o,v) => o.mesh.material.uniforms.smooth1.value = v);

document.getElementById('checkBillboard').onchange = (e) => {
    const obj = objects.find(o => o.id === activeId);
    if(obj) {
        obj.billboard = e.target.checked;
        if(!obj.billboard) obj.mesh.rotation.set(0,0,0);
    }
};

function updateChromaFromPicker(e) {
    const obj = objects.find(o => o.id === activeId);
    if(obj) obj.mesh.material.uniforms.k1.value.set(e.target.value);
}
document.getElementById('chromaToggle').onchange = (e) => {
    const obj = objects.find(o => o.id === activeId);
    if (obj) {
        obj.mesh.material.uniforms.chromaOn.value = e.target.checked;
        document.getElementById('chromaPanel').style.display = e.target.checked ? 'block' : 'none';
    }
};

window.mediaAction = (action) => {
    const obj = objects.find(o => o.id === activeId);
    if(!obj) return;
    
    if(obj.type === 'video' && obj.video) {
        if(action === 'play') obj.video.play();
        if(action === 'pause') obj.video.pause();
        if(action === 'mute') obj.video.muted = !obj.video.muted;
    } else if (obj.gifData) {
        if(action === 'play') obj.gifData.playing = true;
        if(action === 'pause') obj.gifData.playing = false;
    }
};

window.updateProjection = () => {
  const obj = objects.find(o => o.id === activeId);
  if (!obj) return;
  const mode = document.getElementById('projSelect').value;
  scene.remove(obj.mesh);
  
  let geo;
  if (mode === '360') {
    geo = new THREE.SphereGeometry(100, 64, 32);
    obj.mesh.material.side = THREE.BackSide;
  } else if (mode === 'orb') {
    geo = new THREE.SphereGeometry(1.5, 64, 32);
    obj.mesh.material.side = THREE.FrontSide;
  } else if (mode === 'curved') {
     geo = new THREE.CylinderGeometry(5, 5, 2, 32, 1, true, 3.8, 1.8); 
     obj.mesh.scale.set(-1,1,1);
     obj.mesh.material.side = THREE.DoubleSide;
  } else {
    geo = new THREE.PlaneGeometry(obj.originalAspect * 2, 2);
    obj.mesh.material.side = THREE.DoubleSide;
  }
  
  obj.mesh.geometry = geo;
  scene.add(obj.mesh);
  transformCtrl.attach(obj.mesh);
};

window.loadFromWeb = () => {
  const url = document.getElementById('webUrl').value;
  if (!url) return;
  const isGif = url.toLowerCase().includes('.gif');
  const type = url.match(/\.(mp4|webm)/i) ? 'video' : 'image';
  addAsset(url, type, "Web Asset", isGif);
};
document.getElementById('fileInput').onchange = (e) => {
  for (let f of e.target.files) {
    const url = URL.createObjectURL(f);
    const isGif = f.name.toLowerCase().endsWith('.gif');
    addAsset(url, f.type.includes('video') ? 'video' : 'image', f.name, isGif);
  }
};
window.deleteActive = () => {
    const idx = objects.findIndex(o => o.id === activeId);
    if(idx > -1) {
        scene.remove(objects[idx].mesh);
        objects.splice(idx,1);
        transformCtrl.detach();
        document.getElementById('editorUI').style.display = 'none';
        updateLayers();
    }
};
window.centerActive = () => {
    const o = objects.find(o => o.id === activeId);
    if(o) o.mesh.position.set(0, 1.6, -2);
};
function updateLayers() {
  const list = document.getElementById('layerList'); list.innerHTML = '';
  objects.forEach(o => {
    const d = document.createElement('div');
    d.className = `layer-item ${o.id === activeId ? 'active' : ''}`;
    d.innerHTML = `<span>${o.type === 'video' ? 'üé¨' : (o.gifData ? 'üëæ' : 'üñºÔ∏è')}</span> ${o.name.slice(0,18)}`;
    d.onclick = () => selectObject(o.id);
    list.appendChild(d);
  });
}

window.toggleUIPanel = () => {
    const ui = document.getElementById('ui');
    const btn = document.getElementById('toggleUI');
    ui.classList.toggle('minimized');
    if(ui.classList.contains('minimized')) {
        btn.style.display = 'block';
    } else {
        btn.style.display = 'none';
    }
};

function setupVR() {
  if (navigator.xr) {
    navigator.xr.isSessionSupported('immersive-ar').then(ok => {
      if (ok) {
        const btn = document.getElementById('vrBtn');
        btn.style.display = 'block';
        btn.onclick = async () => {
          occlusionEnabled = document.getElementById('checkOcclusion').checked;
          const sessionInit = {
             requiredFeatures: ['local-floor'],
             optionalFeatures: ['dom-overlay', 'depth-sensing'],
             domOverlay: { root: document.body },
             depthSensing: { usagePreference: ['cpu-optimized'], dataFormatPreference: ['luminance-alpha'] }
          };
          xrSession = await navigator.xr.requestSession('immersive-ar', sessionInit);
          renderer.xr.setSession(xrSession);
          xrRefSpace = await xrSession.requestReferenceSpace('local-floor');
          
          if (occlusionEnabled) initDepthOcclusion(xrSession);
        };
      }
    });
  }
}
function initDepthOcclusion(session) {
  const gl = renderer.getContext();
  xrGlBinding = new XRWebGLBinding(session, gl);
  const vs = gl.createShader(gl.VERTEX_SHADER); gl.shaderSource(vs, depthVS); gl.compileShader(vs);
  const fs = gl.createShader(gl.FRAGMENT_SHADER); gl.shaderSource(fs, depthFS); gl.compileShader(fs);
  depthProgram = gl.createProgram(); gl.attachShader(depthProgram, vs); gl.attachShader(depthProgram, fs); gl.linkProgram(depthProgram);
  depthVao = gl.createVertexArray(); gl.bindVertexArray(depthVao);
  const vbo = gl.createBuffer(); gl.bindBuffer(gl.ARRAY_BUFFER, vbo);
  gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([-1,-1, 1,-1, -1,1, -1,1, 1,-1, 1,1]), gl.STATIC_DRAW);
  const loc = gl.getAttribLocation(depthProgram, 'aPos'); gl.enableVertexAttribArray(loc); gl.vertexAttribPointer(loc, 2, gl.FLOAT, false, 0, 0);
  depthTex = gl.createTexture();
}

function toggleLoader(s) { document.getElementById('loader').style.display = s ? 'grid' : 'none'; }

init();
</script>
</body>
</html>
